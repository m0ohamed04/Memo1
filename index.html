<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Memorito</title>
    
    <link rel="icon" href="https://media.tenor.com/HbsmAg2_OUUAAAAj/newt00th-newtooth.gif" type="image/gif">
    <link rel="shortcut icon" href="https://media.tenor.com/HbsmAg2_OUUAAAAj/newt00th-newtooth.gif" type="image/gif">
    <link rel="apple-touch-icon" href="https://media.tenor.com/HbsmAg2_OUUAAAAj/newt00th-newtooth.gif">
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: #000; font-family: 'Cairo', sans-serif; overflow: hidden; color: #fff; height: 100dvh; }

        .svg-heart { width: 100%; height: 100%; fill: currentColor; }

        #loader {
            position: fixed; inset: 0; 
            background: radial-gradient(circle at center, #2a0015, #000000); 
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease;
        }
        .brand { font-family: 'Dancing Script', cursive; font-size: 4rem; color: #ff0055; margin-bottom: 20px; }
        .heart-box { position: relative; width: 80px; height: 80px; }
        .h-icon { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .h-gray { color: #333; }
        
        .h-pink { 
            color: #ff0055; 
            overflow: hidden; 
            height: 0%; 
            width: 100%;
            position: absolute; 
            bottom: 0; 
            animation: fillUp 2.5s ease-in-out forwards; 
            filter: drop-shadow(0 0 10px #ff0055); 
        }
        .h-pink .svg-heart { position: absolute; bottom: 0; left: 0; height: 80px; width: 80px; }
        
        .story-container { width: 100vw; height: 100dvh; overflow-y: scroll; scroll-snap-type: y mandatory; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .slide { width: 100vw; height: 100dvh; scroll-snap-align: start; scroll-snap-stop: always; position: relative; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center; }
        
        .slide-media { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s; }
        .slide-media.loaded { opacity: 1; }

        .overlay-gradient { position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); z-index: 2; pointer-events: none; }

        .slide-content { position: absolute; bottom: 40px; left: 20px; right: 80px; z-index: 3; text-align: left; opacity: 0; transform: translateY(20px); transition: 0.6s ease 0.3s; padding-bottom: env(safe-area-inset-bottom); }
        .slide.active .slide-content { opacity: 1; transform: translateY(0); }
        .slide-content h2 { font-family: 'Dancing Script'; font-size: 3.2rem; color: #ff0055; margin-bottom: 2px; text-shadow: 0 2px 5px #000; }
        .slide-content p { font-size: 1.1rem; color: #eee; font-weight: 600; text-shadow: 0 2px 5px #000; }
        
        .floating-heart { position: absolute; bottom: 40px; right: 20px; left: auto; z-index: 10; width: 45px; height: 45px; color: rgba(255,255,255,0.7); cursor: pointer; padding-bottom: env(safe-area-inset-bottom); }
        .floating-heart.liked { color: #ff0055; animation: pop 0.3s forwards; }

        .heart-particle { position: fixed; pointer-events: none; animation: particleFade 1s ease-out forwards; z-index: 99; color: #ff0055; }

        .final-slide { background: linear-gradient(135deg, #ff758c, #ff7eb3); display: flex; justify-content: center; align-items: center; }
        .message-box { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); width: 85%; padding: 30px 20px; border-radius: 20px; text-align: center; color: #333; }
        .final-message { font-size: 1.1rem; line-height: 1.7; font-weight: 600; }
        .signature { display: block; margin-top: 15px; color: #ff0055; font-size: 1.3rem; font-weight: 800; }
        .btn-restart { display: block; margin: 20px auto 10px; padding: 10px 25px; background: #fff; color: #ff0055; border: 2px solid #ff0055; border-radius: 50px; font-weight: 700; text-decoration: none; }
        .btn-site { display: block; margin: 0 auto; padding: 10px 25px; background: #ff0055; color: #fff; border-radius: 50px; font-weight: 700; text-decoration: none; }

        @keyframes fillUp { from { height: 0%; } to { height: 100%; } }
        @keyframes pop { 50% { transform: scale(1.4); } }
        @keyframes particleFade {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); }
        }
    </style>
</head>
<body>

    <svg style="display: none;">
        <symbol id="icon-heart" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></symbol>
    </svg>

    <div id="loader"><div class="brand">Memorito</div><div class="heart-box"><div class="h-icon h-gray"><svg class="svg-heart"><use href="#icon-heart"></use></svg></div><div class="h-icon h-pink"><svg class="svg-heart"><use href="#icon-heart"></use></svg></div></div></div>

    <div class="story-container" id="stories"></div>

    <script>
        const totalSlides = 82;
        const container = document.getElementById('stories');
        // متغير للتحكم في الصوت بشكل عام
        let globalMuted = true;

        for (let i = 1; i <= totalSlides; i++) {
            const div = document.createElement('div');
            div.className = 'slide';
            div.id = `slide-${i}`;
            div.innerHTML = `
                <div id="media-container-${i}" style="width:100%; height:100%;"></div>
                <div class="overlay-gradient"></div>
                <div class="slide-content">
                    <h2>Memory ${i}</h2>
                    <p>best memories with my fav person</p>
                </div>
                <div class="floating-heart" onclick="toggleLike(this)">
                    <svg class="svg-heart"><use href="#icon-heart"></use></svg>
                </div>
            `;
            container.appendChild(div);
        }

        const final = document.createElement('div');
        final.className = 'slide final-slide';
        final.id = 'final-slide';
        final.innerHTML = `<div class="message-box">
            <p class="final-message">ربنا يخليكي ليا يا ميمو يا حبيبتي يارب والعمر كلو مع بعض ومشوفش فيكي اي وحش وافضل اشوفك مبسوطه ونفضل نرخم علي بعض كدا انا عاوز اقضي الباقي من عمري كلو معاكي هتفضلي حبيبتي لحد اخر يوم فعمري هتفضلي اختياري الاول و الاخير بحبك اووووي يا ميمو ربنا ميحرمني منك ابدا يا اجمل رزق من ربنا يا احلي حاجه حصلتلي فحياتي بحبك اوي يا ميمو اوي اوي خليكي فاكرة إني هفضل جنبك العمر كلو ومش هزهق ولا هبعد ولا هتغير وهفضل أحبك ديماً وتفضلي دلوعتي بحبك أوي. <span class="signature">(حمودك)</span></p>
            <a href="#" onclick="window.scrollTo(0,0); return false;" class="btn-restart">العودة لأول memory</a>
            <a href="https://memorito.netlify.app/" class="btn-site">العودة للموقع</a>
        </div>`;
        container.appendChild(final);

        window.onload = () => setTimeout(() => { document.getElementById('loader').style.opacity = '0'; setTimeout(() => document.getElementById('loader').style.display = 'none', 800); }, 2500);

        function toggleLike(btn) { 
            btn.classList.toggle('liked'); 
            if (btn.classList.contains('liked')) {
                createHeartExplosion(btn);
            }
        }

        function createHeartExplosion(btn) {
            const rect = btn.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart-particle';
                heart.innerHTML = '<svg class="svg-heart"><use href="#icon-heart"></use></svg>';
                const size = Math.random() * 20 + 10;
                heart.style.width = size + 'px';
                heart.style.height = size + 'px';
                heart.style.left = (centerX - size/2) + 'px';
                heart.style.top = (centerY - size/2) + 'px';

                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 100 + 60;
                const tx = Math.cos(angle) * distance + 'px';
                const ty = Math.sin(angle) * distance + 'px';
                heart.style.setProperty('--tx', tx);
                heart.style.setProperty('--ty', ty);

                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            }
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    const idStr = entry.target.id.split('-')[1];
                    const id = parseInt(idStr);
                    
                    if (!isNaN(id)) {
                        loadMedia(id); 
                        if (id < totalSlides) loadMedia(id + 1); 
                    }

                    const v = entry.target.querySelector('video');
                    if (v) {
                        // تطبيق حالة الصوت الحالية
                        v.muted = globalMuted;
                        // محاولة التشغيل
                        var playPromise = v.play();
                        if (playPromise !== undefined) {
                            playPromise.catch(error => {
                                // لو فشل التشغيل بالصوت (بسبب قيود المتصفح)، شغله صامت
                                if (!globalMuted) {
                                    console.log("Autoplay with sound blocked, reverting to muted.");
                                    v.muted = true;
                                    v.play();
                                }
                            });
                        }
                    }
                } else {
                    entry.target.classList.remove('active');
                    const v = entry.target.querySelector('video');
                    if (v) { v.pause(); v.currentTime = 0; }
                }
            });
        }, { threshold: 0.6 });

        function loadMedia(id) {
            const box = document.getElementById(`media-container-${id}`);
            if (!box || box.innerHTML !== "") return;
            
            const v = document.createElement('video');
            v.className = 'slide-media';
            v.loop = true; 
            // يبدأ صامت دائماً لتسريع التحميل حتى يتم التفاعل
            v.muted = true; 
            v.setAttribute('playsinline', '');
            v.setAttribute('preload', 'auto'); 
            v.src = `images/${id}.mp4`;
            
            v.oncanplay = () => v.classList.add('loaded');
            v.onerror = () => {
                v.remove();
                const img = document.createElement('img');
                img.className = 'slide-media';
                img.src = `images/${id}.jpg`;
                img.onload = () => img.classList.add('loaded');
                img.onerror = () => { img.src = `images/${id}.JPG`; img.onload = () => img.classList.add('loaded'); };
                box.appendChild(img);
            };
            box.appendChild(v);
            
            const slide = box.closest('.slide');
            
            // تعديل الضغط لتفعيل الصوت للكل
            slide.onclick = (e) => { 
                if (e.target.closest('.floating-heart')) return;
                
                // المستخدم ضغط، إذن نلغي الكتم العام
                globalMuted = false;
                
                // إلغاء كتم الفيديو الحالي فوراً
                if(v) v.muted = false; 
            };
        }

        document.querySelectorAll('.slide').forEach(s => observer.observe(s));
    </script>
</body>
</html>
